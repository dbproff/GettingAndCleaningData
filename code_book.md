---
title: "CODEBOOK for John Hopkins Project Course - Getting and Cleanning Data"
---

## Dataset structure

**tidyData**  contains the data measurements of 10299 time windows in which six activities were pertformed by 30 subjects. The transormations performed on the selected measurements are the mean and standard deviation of the sensors measurements. The resulting dataset is a 10299 x 68 dataframe of 10299 obsevations and 68 variables, includig 66 features
```{r}
> 		str(tidyData)
'data.frame':	10299 obs. of  68 variables:
 $ Activity                 : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ SubjectId                : int  1 1 1 1 1 1 1 1 1 1 ...
 $ tBodyAcc_Mean_X          : num  0.289 0.278 0.28 0.279 0.277 ...
 $ tBodyAcc_Mean_Y          : num  -0.0203 -0.0164 -0.0195 -0.0262 -0.0166 ...
 $ tBodyAcc_Mean_Z          : num  -0.133 -0.124 -0.113 -0.123 -0.115 ...
 $ tBodyAcc_Std_X           : num  -0.995 -0.998 -0.995 -0.996 -0.998 ...
 $ tBodyAcc_Std_Y           : num  -0.983 -0.975 -0.967 -0.983 -0.981 ...
 $ tBodyAcc_Std_Z           : num  -0.914 -0.96 -0.979 -0.991 -0.99 ...
 $ tGravityAcc_Mean_X       : num  0.963 0.967 0.967 0.968 0.968 ...
 $ tGravityAcc_Mean_Y       : num  -0.141 -0.142 -0.142 -0.144 -0.149 ...
 $ tGravityAcc_Mean_Z       : num  0.1154 0.1094 0.1019 0.0999 0.0945 ...
 $ tGravityAcc_Std_X        : num  -0.985 -0.997 -1 -0.997 -0.998 ...
 $ tGravityAcc_Std_Y        : num  -0.982 -0.989 -0.993 -0.981 -0.988 ...
 $ tGravityAcc_Std_Z        : num  -0.878 -0.932 -0.993 -0.978 -0.979 ...
 $ tBodyAccJerk_Mean_X      : num  0.078 0.074 0.0736 0.0773 0.0734 ...
 $ tBodyAccJerk_Mean_Y      : num  0.005 0.00577 0.0031 0.02006 0.01912 ...
 $ tBodyAccJerk_Mean_Z      : num  -0.06783 0.02938 -0.00905 -0.00986 0.01678 ...
 $ tBodyAccJerk_Std_X       : num  -0.994 -0.996 -0.991 -0.993 -0.996 ...
 $ tBodyAccJerk_Std_Y       : num  -0.988 -0.981 -0.981 -0.988 -0.988 ...
 $ tBodyAccJerk_Std_Z       : num  -0.994 -0.992 -0.99 -0.993 -0.992 ...
 $ tBodyGyro_Mean_X         : num  -0.0061 -0.0161 -0.0317 -0.0434 -0.034 ...
 $ tBodyGyro_Mean_Y         : num  -0.0314 -0.0839 -0.1023 -0.0914 -0.0747 ...
 $ tBodyGyro_Mean_Z         : num  0.1077 0.1006 0.0961 0.0855 0.0774 ...
 $ tBodyGyro_Std_X          : num  -0.985 -0.983 -0.976 -0.991 -0.985 ...
 $ tBodyGyro_Std_Y          : num  -0.977 -0.989 -0.994 -0.992 -0.992 ...
 $ tBodyGyro_Std_Z          : num  -0.992 -0.989 -0.986 -0.988 -0.987 ...
 $ tBodyGyroJerk_Mean_X     : num  -0.0992 -0.1105 -0.1085 -0.0912 -0.0908 ...
 $ tBodyGyroJerk_Mean_Y     : num  -0.0555 -0.0448 -0.0424 -0.0363 -0.0376 ...
 $ tBodyGyroJerk_Mean_Z     : num  -0.062 -0.0592 -0.0558 -0.0605 -0.0583 ...
 $ tBodyGyroJerk_Std_X      : num  -0.992 -0.99 -0.988 -0.991 -0.991 ...
 $ tBodyGyroJerk_Std_Y      : num  -0.993 -0.997 -0.996 -0.997 -0.996 ...
 $ tBodyGyroJerk_Std_Z      : num  -0.992 -0.994 -0.992 -0.993 -0.995 ...
 $ tBodyAccMag_Mean         : num  -0.959 -0.979 -0.984 -0.987 -0.993 ...
 $ tBodyAccMag_Std          : num  -0.951 -0.976 -0.988 -0.986 -0.991 ...
 $ tGravityAccMag_Mean      : num  -0.959 -0.979 -0.984 -0.987 -0.993 ...
 $ tGravityAccMag_Std       : num  -0.951 -0.976 -0.988 -0.986 -0.991 ...
 $ tBodyAccJerkMag_Mean     : num  -0.993 -0.991 -0.989 -0.993 -0.993 ...
 $ tBodyAccJerkMag_Std      : num  -0.994 -0.992 -0.99 -0.993 -0.996 ...
 $ tBodyGyroMag_Mean        : num  -0.969 -0.981 -0.976 -0.982 -0.985 ...
 $ tBodyGyroMag_Std         : num  -0.964 -0.984 -0.986 -0.987 -0.989 ...
 $ tBodyGyroJerkMag_Mean    : num  -0.994 -0.995 -0.993 -0.996 -0.996 ...
 $ tBodyGyroJerkMag_Std     : num  -0.991 -0.996 -0.995 -0.995 -0.995 ...
 $ fBodyAcc_Mean_X          : num  -0.995 -0.997 -0.994 -0.995 -0.997 ...
 $ fBodyAcc_Mean_Y          : num  -0.983 -0.977 -0.973 -0.984 -0.982 ...
 $ fBodyAcc_Mean_Z          : num  -0.939 -0.974 -0.983 -0.991 -0.988 ...
 $ fBodyAcc_Std_X           : num  -0.995 -0.999 -0.996 -0.996 -0.999 ...
 $ fBodyAcc_Std_Y           : num  -0.983 -0.975 -0.966 -0.983 -0.98 ...
 $ fBodyAcc_Std_Z           : num  -0.906 -0.955 -0.977 -0.99 -0.992 ...
 $ fBodyAccJerk_Mean_X      : num  -0.992 -0.995 -0.991 -0.994 -0.996 ...
 $ fBodyAccJerk_Mean_Y      : num  -0.987 -0.981 -0.982 -0.989 -0.989 ...
 $ fBodyAccJerk_Mean_Z      : num  -0.99 -0.99 -0.988 -0.991 -0.991 ...
 $ fBodyAccJerk_Std_X       : num  -0.996 -0.997 -0.991 -0.991 -0.997 ...
 $ fBodyAccJerk_Std_Y       : num  -0.991 -0.982 -0.981 -0.987 -0.989 ...
 $ fBodyAccJerk_Std_Z       : num  -0.997 -0.993 -0.99 -0.994 -0.993 ...
 $ fBodyGyro_Mean_X         : num  -0.987 -0.977 -0.975 -0.987 -0.982 ...
 $ fBodyGyro_Mean_Y         : num  -0.982 -0.993 -0.994 -0.994 -0.993 ...
 $ fBodyGyro_Mean_Z         : num  -0.99 -0.99 -0.987 -0.987 -0.989 ...
 $ fBodyGyro_Std_X          : num  -0.985 -0.985 -0.977 -0.993 -0.986 ...
 $ fBodyGyro_Std_Y          : num  -0.974 -0.987 -0.993 -0.992 -0.992 ...
 $ fBodyGyro_Std_Z          : num  -0.994 -0.99 -0.987 -0.989 -0.988 ...
 $ fBodyAccMag_Mean         : num  -0.952 -0.981 -0.988 -0.988 -0.994 ...
 $ fBodyAccMag_Std          : num  -0.956 -0.976 -0.989 -0.987 -0.99 ...
 $ fBodyBodyAccJerkMag_Mean : num  -0.994 -0.99 -0.989 -0.993 -0.996 ...
 $ fBodyBodyAccJerkMag_Std  : num  -0.994 -0.992 -0.991 -0.992 -0.994 ...
 $ fBodyBodyGyroMag_Mean    : num  -0.98 -0.988 -0.989 -0.989 -0.991 ...
 $ fBodyBodyGyroMag_Std     : num  -0.961 -0.983 -0.986 -0.988 -0.989 ...
 $ fBodyBodyGyroJerkMag_Mean: num  -0.992 -0.996 -0.995 -0.995 -0.995 ...
 $ fBodyBodyGyroJerkMag_Std : num  -0.991 -0.996 -0.995 -0.995 -0.995 ...
```
**tidyDataSummary**  contains a summary of the *tidyData* dataset. The summary is performed by taking the mean of every feature in the *tidyData* dataset for each of the six activities and each of the 30 subjects. The resulting dataset is a 180 x 68 dataframe of 180 means for 66 features.
```{r}
> 	str(tidyDataSummary)
Classes ‘data.table’ and 'data.frame':	180 obs. of  68 variables:
 $ SubjectId                : int  1 1 1 1 1 1 2 2 2 2 ...
 $ Activity                 : Factor w/ 6 levels "LAYING","SITTING",..: 1 2 3 4 5 6 1 2 3 4 ...
 $ tBodyAcc_Mean_X          : num  0.222 0.261 0.279 0.277 0.289 ...
 $ tBodyAcc_Mean_Y          : num  -0.04051 -0.00131 -0.01614 -0.01738 -0.00992 ...
 $ tBodyAcc_Mean_Z          : num  -0.113 -0.105 -0.111 -0.111 -0.108 ...
 $ tBodyAcc_Std_X           : num  -0.928 -0.977 -0.996 -0.284 0.03 ...
 $ tBodyAcc_Std_Y           : num  -0.8368 -0.9226 -0.9732 0.1145 -0.0319 ...
 $ tBodyAcc_Std_Z           : num  -0.826 -0.94 -0.98 -0.26 -0.23 ...
 $ tGravityAcc_Mean_X       : num  -0.249 0.832 0.943 0.935 0.932 ...
 $ tGravityAcc_Mean_Y       : num  0.706 0.204 -0.273 -0.282 -0.267 ...
 $ tGravityAcc_Mean_Z       : num  0.4458 0.332 0.0135 -0.0681 -0.0621 ...
 $ tGravityAcc_Std_X        : num  -0.897 -0.968 -0.994 -0.977 -0.951 ...
 $ tGravityAcc_Std_Y        : num  -0.908 -0.936 -0.981 -0.971 -0.937 ...
 $ tGravityAcc_Std_Z        : num  -0.852 -0.949 -0.976 -0.948 -0.896 ...
 $ tBodyAccJerk_Mean_X      : num  0.0811 0.0775 0.0754 0.074 0.0542 ...
 $ tBodyAccJerk_Mean_Y      : num  0.003838 -0.000619 0.007976 0.028272 0.02965 ...
 $ tBodyAccJerk_Mean_Z      : num  0.01083 -0.00337 -0.00369 -0.00417 -0.01097 ...
 $ tBodyAccJerk_Std_X       : num  -0.9585 -0.9864 -0.9946 -0.1136 -0.0123 ...
 $ tBodyAccJerk_Std_Y       : num  -0.924 -0.981 -0.986 0.067 -0.102 ...
 $ tBodyAccJerk_Std_Z       : num  -0.955 -0.988 -0.992 -0.503 -0.346 ...
 $ tBodyGyro_Mean_X         : num  -0.0166 -0.0454 -0.024 -0.0418 -0.0351 ...
 $ tBodyGyro_Mean_Y         : num  -0.0645 -0.0919 -0.0594 -0.0695 -0.0909 ...
 $ tBodyGyro_Mean_Z         : num  0.1487 0.0629 0.0748 0.0849 0.0901 ...
 $ tBodyGyro_Std_X          : num  -0.874 -0.977 -0.987 -0.474 -0.458 ...
 $ tBodyGyro_Std_Y          : num  -0.9511 -0.9665 -0.9877 -0.0546 -0.1263 ...
 $ tBodyGyro_Std_Z          : num  -0.908 -0.941 -0.981 -0.344 -0.125 ...
 $ tBodyGyroJerk_Mean_X     : num  -0.1073 -0.0937 -0.0996 -0.09 -0.074 ...
 $ tBodyGyroJerk_Mean_Y     : num  -0.0415 -0.0402 -0.0441 -0.0398 -0.044 ...
 $ tBodyGyroJerk_Mean_Z     : num  -0.0741 -0.0467 -0.049 -0.0461 -0.027 ...
 $ tBodyGyroJerk_Std_X      : num  -0.919 -0.992 -0.993 -0.207 -0.487 ...
 $ tBodyGyroJerk_Std_Y      : num  -0.968 -0.99 -0.995 -0.304 -0.239 ...
 $ tBodyGyroJerk_Std_Z      : num  -0.958 -0.988 -0.992 -0.404 -0.269 ...
 $ tBodyAccMag_Mean         : num  -0.8419 -0.9485 -0.9843 -0.137 0.0272 ...
 $ tBodyAccMag_Std          : num  -0.7951 -0.9271 -0.9819 -0.2197 0.0199 ...
 $ tGravityAccMag_Mean      : num  -0.8419 -0.9485 -0.9843 -0.137 0.0272 ...
 $ tGravityAccMag_Std       : num  -0.7951 -0.9271 -0.9819 -0.2197 0.0199 ...
 $ tBodyAccJerkMag_Mean     : num  -0.9544 -0.9874 -0.9924 -0.1414 -0.0894 ...
 $ tBodyAccJerkMag_Std      : num  -0.9282 -0.9841 -0.9931 -0.0745 -0.0258 ...
 $ tBodyGyroMag_Mean        : num  -0.8748 -0.9309 -0.9765 -0.161 -0.0757 ...
 $ tBodyGyroMag_Std         : num  -0.819 -0.935 -0.979 -0.187 -0.226 ...
 $ tBodyGyroJerkMag_Mean    : num  -0.963 -0.992 -0.995 -0.299 -0.295 ...
 $ tBodyGyroJerkMag_Std     : num  -0.936 -0.988 -0.995 -0.325 -0.307 ...
 $ fBodyAcc_Mean_X          : num  -0.9391 -0.9796 -0.9952 -0.2028 0.0382 ...
 $ fBodyAcc_Mean_Y          : num  -0.86707 -0.94408 -0.97707 0.08971 0.00155 ...
 $ fBodyAcc_Mean_Z          : num  -0.883 -0.959 -0.985 -0.332 -0.226 ...
 $ fBodyAcc_Std_X           : num  -0.9244 -0.9764 -0.996 -0.3191 0.0243 ...
 $ fBodyAcc_Std_Y           : num  -0.834 -0.917 -0.972 0.056 -0.113 ...
 $ fBodyAcc_Std_Z           : num  -0.813 -0.934 -0.978 -0.28 -0.298 ...
 $ fBodyAccJerk_Mean_X      : num  -0.9571 -0.9866 -0.9946 -0.1705 -0.0277 ...
 $ fBodyAccJerk_Mean_Y      : num  -0.9225 -0.9816 -0.9854 -0.0352 -0.1287 ...
 $ fBodyAccJerk_Mean_Z      : num  -0.948 -0.986 -0.991 -0.469 -0.288 ...
 $ fBodyAccJerk_Std_X       : num  -0.9642 -0.9875 -0.9951 -0.1336 -0.0863 ...
 $ fBodyAccJerk_Std_Y       : num  -0.932 -0.983 -0.987 0.107 -0.135 ...
 $ fBodyAccJerk_Std_Z       : num  -0.961 -0.988 -0.992 -0.535 -0.402 ...
 $ fBodyGyro_Mean_X         : num  -0.85 -0.976 -0.986 -0.339 -0.352 ...
 $ fBodyGyro_Mean_Y         : num  -0.9522 -0.9758 -0.989 -0.1031 -0.0557 ...
 $ fBodyGyro_Mean_Z         : num  -0.9093 -0.9513 -0.9808 -0.2559 -0.0319 ...
 $ fBodyGyro_Std_X          : num  -0.882 -0.978 -0.987 -0.517 -0.495 ...
 $ fBodyGyro_Std_Y          : num  -0.9512 -0.9623 -0.9871 -0.0335 -0.1814 ...
 $ fBodyGyro_Std_Z          : num  -0.917 -0.944 -0.982 -0.437 -0.238 ...
 $ fBodyAccMag_Mean         : num  -0.8618 -0.9478 -0.9854 -0.1286 0.0966 ...
 $ fBodyAccMag_Std          : num  -0.798 -0.928 -0.982 -0.398 -0.187 ...
 $ fBodyBodyAccJerkMag_Mean : num  -0.9333 -0.9853 -0.9925 -0.0571 0.0262 ...
 $ fBodyBodyAccJerkMag_Std  : num  -0.922 -0.982 -0.993 -0.103 -0.104 ...
 $ fBodyBodyGyroMag_Mean    : num  -0.862 -0.958 -0.985 -0.199 -0.186 ...
 $ fBodyBodyGyroMag_Std     : num  -0.824 -0.932 -0.978 -0.321 -0.398 ...
 $ fBodyBodyGyroJerkMag_Mean: num  -0.942 -0.99 -0.995 -0.319 -0.282 ...
 $ fBodyBodyGyroJerkMag_Std : num  -0.933 -0.987 -0.995 -0.382 -0.392 ...
 - attr(*, "idvars")= chr  "SubjectId" "Activity"
 - attr(*, "rdimnames")=List of 2
  ..$ :'data.frame':	180 obs. of  2 variables:
  .. ..$ SubjectId: int  1 1 1 1 1 1 2 2 2 2 ...
  .. ..$ Activity : Factor w/ 6 levels "LAYING","SITTING",..: 1 2 3 4 5 6 1 2 3 4 ...
  ..$ :'data.frame':	66 obs. of  1 variable:
  .. ..$ featureCode: Factor w/ 66 levels "tBodyAcc_Mean_X",..: 1 2 3 4 5 6 7 8 9 10 ...
 - attr(*, ".internal.selfref")=<externalptr> 
```


## The Code
Project source code is in the file : [a relative link](run_analysis.R)

run\_analysis
================

Including Code
--------------

### run\_analysis.R that does the following:

-   Merges the training and the test sets to create one data set.
-   Extracts only the measurements on the mean and standard deviation for each measurement.
-   Uses descriptive activity names to name the activities in the data set
-   Appropriately labels the data set with descriptive variable names.
-   From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.

0 load required libraries and download data for the project.
------------------------------------------------------------

``` r
    rm(list = ls(all.names = TRUE))
    wd <<- "C:/Users/user/Documents/R/3.Getting And Cleansing Data/week4/final"
    gwd <- getwd()
    
    if ( gwd != wd ) {setwd (wd)}
    
    if("data.table" %in% rownames(installed.packages()) == FALSE) {install.packages("data.table")}
    require(data.table)
```

    ## Loading required package: data.table

``` r
    if("plyr" %in% rownames(installed.packages()) == FALSE) {install.packages("plyr")}
    require(plyr) 
```

    ## Loading required package: plyr

``` r
    if("reshape" %in% rownames(installed.packages()) == FALSE) {install.packages("reshape")}
    require(reshape)
```

    ## Loading required package: reshape

    ## 
    ## Attaching package: 'reshape'

    ## The following objects are masked from 'package:plyr':
    ## 
    ##     rename, round_any

    ## The following object is masked from 'package:data.table':
    ## 
    ##     melt

``` r
    if("downloader" %in% rownames(installed.packages()) == FALSE) {install.packages("downloader")}
    require(downloader)
```

    ## Loading required package: downloader

``` r
    ###  download data archive and unzip 
    fileUrl <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
    dataFile = "./getdata-projectfiles-UCI HAR Dataset.zip"
    if(file.exists(dataFile)) {
        message("File is already downloaded")
    } else {
        download(fileUrl, dataFile, mode = "wb")
        unzip(dataFile)
    }
```

    ## File is already downloaded

1 Merges the training and the test sets to create one data set.
---------------------------------------------------------------

    ### read train files

``` r
        x_train <- read.table("./UCI HAR Dataset/train/X_train.txt")
        y_train <- read.table("./UCI HAR Dataset/train/y_train.txt")
        subject_train <- read.table("./UCI HAR Dataset/train/subject_train.txt")
    ### read test files

        x_test<- read.table("./UCI HAR Dataset/test/X_test.txt")
        y_test <- read.table("./UCI HAR Dataset/test/y_test.txt") 
        subject_test <- read.table("./UCI HAR Dataset/test/subject_test.txt")

            ### TRAINING DATA STRUCTURE SUMMARY  
                # summary(x_train)
                # summary(y_train)
                # summary(subject_train)

            ### TEST DATA STRUCTURE SUMMARY  
                # summary(x_test)
                # summary(y_test)
                # summary(subject_test)
```

Uses descriptive activity names to name the activities in the data set
----------------------------------------------------------------------

    ### read features file 

``` r
    features <- read.table("./UCI HAR Dataset/features.txt")
    

    ### Appropriately labels the data set with descriptive variable names.
        names(x_train)<-features[,2]
        names(x_test)<-features[,2]

        names(y_train)<-c("ActivityId")
        names(y_test)<-c("ActivityId")

        names(subject_train)<-c("SubjectId")
        names(subject_test)<-c("SubjectId")



    ### column bind subject, activity and features data:
        train_data <- cbind(subject_train, y_train, x_train)
        test_data  <- cbind(subject_test, y_test, x_test)

    ### row bind train and test data:
        mergedData <- rbind(train_data, test_data)
```

3 Extracts only the measurements on the mean and standard deviation for each measurement.
-----------------------------------------------------------------------------------------

    ### use pattern matching to extract mean and std data and keep subjectid and activityid

``` r
                mergedData <- mergedData[,grepl("SubjectId|ActivityId|mean\\(\\)|std\\(\\)", names(mergedData))]
```

Uses descriptive activity names to name the activities in the mergedData set
----------------------------------------------------------------------------

``` r
                    ### join mergedData with activity_labels on ActivityId
        activity_labels <- read.table("./UCI HAR Dataset/activity_labels.txt")
        names(activity_labels) <- c("ActivityId", "Activity")
        mergedData <- join( mergedData,activity_labels, by="ActivityId",  match="first")     
    ### tidy column names
    ### remove "()"
        names(mergedData) <- gsub("\\(\\)", "", names(mergedData)) 
    ### replace dashes with undescores 
        names(mergedData) <- gsub("-", "_", names(mergedData))  
    ### capitalize Mean and Std
        names(mergedData) <- gsub("mean", "Mean", names(mergedData)) 
        names(mergedData) <- gsub("std", "Std", names(mergedData)) 
    
    ###  move activity column in the beginning  &  remove activityId index column 
        col_idx <- grep("^Activity$", names(mergedData))
        tidyData <- mergedData[, c(col_idx, (1:ncol(mergedData))[-col_idx])]
        rm(mergedData)
        tidyData <- tidyData[,-2]
        str(tidyData)
    
    ### Write the dataset of activities/subjects/features to a file   
    tidyDataFile <- "GettingCleaningData_Project.TXT"
    write.table(tidyData, tidyDataFile, row.names=FALSE)
```

5 From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.
------------------------------------------------------------------------------------------------------------------------------------------------

``` r
    ### set SubjectId, ActivityId, Activity as a key.
         tidyData <- as.data.table(tidyData)
        # tidyData <- tbl_df(tidyData)
         setkey(tidyData, SubjectId, Activity)

    ### reshape dataset from a short and wide format to a tall and narrow format.

        tidyData <- data.table(melt(tidyData, key(tidyData), variable.name="featureCode"))

## Create a data set with the average of each featureCode for each Activity and each SubjectId.
    setkey(tidyData, SubjectId, Activity,featureCode)
  
    ### Using cast to move featureCode into columns 
    tidyDataSummary <- cast(tidyData, SubjectId+Activity ~ featureCode,mean)
    tidyDataSummary <- as.data.table(tidyDataSummary)
    rm(tidyData)
    str(tidyDataSummary)
    ### Write the final tidy dataset of activities/subjects/features Means to a file   
    tidyDataFile <- "GettingCleaningData_Project_Mean.TXT"
    write.table(tidyDataSummary, tidyDataFile, row.names=FALSE)
```
